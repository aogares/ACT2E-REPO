<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/css/bootstrap.min.css">
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.4/dist/jquery.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/js/bootstrap.bundle.min.js"></script>
</head>
<style>
	body {
		background-color: #B5CED0;
	}
	}
	.table{
		background-color:  #cedbdc;
	}
	 .box {
	    width: 1000px;
	    margin: 50px auto;
	    padding: 20px;
	    /* border: 2px solid red; */
	    font-family: arial;
	    font-size: 16px;
	    border-radius: 20px;
	    background-color:#e2f9fa;
	    }
	.h2 {
	text-align: center;
	}
	.th {
	text-align: center;
	}
	
</style>
<body>  
	<div class="menu-area">
		<a class="logo" href="#" style="color:black"><img src="2.png"  style="width:48px;height:48px;float:left"> Paradise Resort</a>
		<ul class="nav">
			<li>
				<a href="index.html#home" style="color:black">Home</a>
			</li>
			<li>
				<a href="index.html#about" style="color:black">About</a>
			</li>
			<li>
				<a href="crud.html" style="color:black">Register</a>
			</li>
			<li>
				<a href="app.html" style="color:black">Crud</a>
			</li>
			<li>
				<a href="index.html#contact" style="color:black">Contact</a>
			</li>
			<li>
				<button type="submit" id="submit">See Table</button>
			</li>
		</ul>
	</div>
	<br>
	
	</br>
	<br>
	
	</br>
 <div class="container1">
      <h1>Table</h1>
      <table>
          <thead>
              <tr>
                  <th>Name</th>
                  <th>Address</th>
                  <th>Phone</th>
                  <th>Email</th>
              </tr>
          </thead>
          <tbody>
          </tbody>
      </table>
  </div>
</body>
</html>

<script type="module">
  // Import the functions you need from the SDKs you need
  import { initializeApp } from "https://www.gstatic.com/firebasejs/9.20.0/firebase-app.js";
  import { getDatabase, ref, set, get, child, remove, update } from "https://www.gstatic.com/firebasejs/9.20.0/firebase-database.js";
   
  // Paste the code from Firebase
  const firebaseConfig = {
    apiKey: "AIzaSyCSQO3WY8KmfVXM6siqZVj4-hqHbB4rirk",
    authDomain: "fir-crud-dc0ee.firebaseapp.com",
    databaseURL: "https://fir-crud-dc0ee-default-rtdb.firebaseio.com",
    projectId: "fir-crud-dc0ee",
    storageBucket: "fir-crud-dc0ee.appspot.com",
    messagingSenderId: "578294013427",
    appId: "1:578294013427:web:54894730874ac48b80c686"
  };

  // Initialize Firebase
  const app = initializeApp(firebaseConfig);
   
  // Get a reference to the database service
  const db = getDatabase(app);

const dataContainer = document.querySelector('tbody')

  // give complete path to fetch data as given during sending
  var fetchedData = database.ref('messages/')
  fetchedData.on('value', (snapshot) => {
      var data = snapshot.val()
      // now set data in table
      var htmlData = ''
      for(var key in data){
          var value = data[key]
          htmlData += `
              <tr>
                  <td>${value.name}</td>
                  <td>${value.address}</td>
                  <td>${value.phone}</td>
		   <td>${value.email}</td>
                  <td>
                      <button onclick="readyForUpdate('${key}', this)">Update</button>
                      <button onclick="removeMess('${key}')">Delete</button>
                  </td>
              </tr>
          `;
      }
      // we use unique id's as reference to delete and update data
      dataContainer.innerHTML = htmlData
  })

  // remove message function
  function removeMess(uniqueId){
      database.ref('messages/' + uniqueId).remove()
      // this realtime remove will delete data without any loading
      // as data is updated, it refetch and rerender in html automatically
      alert("Data Removed");
  }

  // update function 
  function readyForUpdate(uniqueId, elem){
      // lets ready for update
      // it will get all the td of the tr in which btn in clicked
      var siblingTd = elem.parentElement.parentElement.getElementsByTagName('td')
      // convert first three td to editable
      for(var i = 0; i < siblingTd.length-1; i++){
          siblingTd[i].contentEditable = true
          siblingTd[i].classList.add('temp-update-class')
      }
      // also change onclick function
      elem.setAttribute('onclick', `updateNow('${uniqueId}')`)
      elem.innerHTML = 'Send'
  }

  // create updateNow function
  function updateNow(uniqueId){
      var contentId = document.querySelectorAll('.temp-update-class')
      // now create obj using same keys as used during sending
      var obj = {
          'name': contentId[0].textContent,
          'address': contentId[1].textContent,
          'phone': contentId[2].textContent,
	  'email': contentId[2].textContent
      }
      // create reference to the data first where data will update
      // uniqueId will be the id of each message in db
      var listRef = database.ref('messages/' + uniqueId)
      // now provide updated data
      listRef.update(obj)
      // after update new data will rerender automatically
      // same as during delete
      alert("Data Updated");
  }


  </script>
